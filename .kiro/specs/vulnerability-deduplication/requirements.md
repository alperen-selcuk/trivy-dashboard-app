# Requirements Document: Vulnerability Deduplication

## Introduction

Currently, the dashboard displays vulnerabilities cumulatively across all image versions. When an image has multiple versions (v1, v2, v3), the same vulnerability appearing in multiple versions is counted multiple times, leading to inflated vulnerability counts. This feature ensures that only the latest scan results are counted and displayed, eliminating duplicate vulnerability counts across versions.

## Glossary

- **Image**: A Docker container image (e.g., `nginx`)
- **Version/Tag**: A specific version of an image (e.g., `nginx:1.19`, `nginx:1.20`)
- **Vulnerability**: A security issue identified by Trivy (e.g., CVE-2021-12345)
- **Scan**: A Trivy security scan of a specific image version
- **Latest Scan**: The most recent scan for a given image version, determined by scan_time
- **Duplicate Vulnerability**: The same vulnerability appearing in multiple scans of the same image
- **Dashboard**: The web interface displaying vulnerability information

## Requirements

### Requirement 1: Count Vulnerabilities from Latest Scan Only

**User Story:** As a security analyst, I want vulnerability counts to reflect only the latest scan results, so that I can see accurate vulnerability metrics without duplication.

#### Acceptance Criteria

1. WHEN displaying vulnerability counts for an image version, THE Dashboard SHALL count only vulnerabilities from the latest scan for that version
2. WHEN multiple scans exist for the same image version, THE Dashboard SHALL identify the latest scan by comparing scan_time values
3. WHEN a new scan is performed for an image version, THE Dashboard SHALL update the displayed count to reflect only the new scan's vulnerabilities
4. WHEN displaying total vulnerabilities per image, THE Dashboard SHALL sum unique vulnerabilities across all versions (not cumulative counts)

### Requirement 2: Deduplicate Vulnerabilities Across Versions

**User Story:** As a security analyst, I want to see unique vulnerabilities across all versions of an image, so that I understand the true vulnerability landscape.

#### Acceptance Criteria

1. WHEN an image has multiple versions with overlapping vulnerabilities, THE Dashboard SHALL identify and deduplicate these vulnerabilities
2. WHEN displaying vulnerability details, THE Dashboard SHALL show each unique vulnerability only once in the aggregated view
3. WHEN a vulnerability appears in multiple versions, THE Dashboard SHALL track which versions are affected
4. WHEN filtering by severity, THE Dashboard SHALL apply deduplication before counting

### Requirement 3: Display Scan Metadata

**User Story:** As a security analyst, I want to see when each scan was performed, so that I can understand the freshness of the data.

#### Acceptance Criteria

1. WHEN displaying image versions, THE Dashboard SHALL show the scan_time for each version's latest scan
2. WHEN multiple scans exist for a version, THE Dashboard SHALL display only the latest scan_time
3. WHEN sorting by scan time, THE Dashboard SHALL order results by the most recent scan first

### Requirement 4: Display CVE Information and References

**User Story:** As a security analyst, I want to see CVE codes and reference links for vulnerabilities, so that I can research and understand the security issues.

#### Acceptance Criteria

1. WHEN displaying vulnerability details, THE Dashboard SHALL show the CVE code if available (e.g., CVE-2021-12345)
2. WHEN a vulnerability has a CVE code, THE Dashboard SHALL display it prominently
3. WHEN displaying vulnerability information, THE Dashboard SHALL include a reference link to the CVE details
4. WHEN a reference link is available, THE Dashboard SHALL make it clickable and open in a new tab
5. WHEN a vulnerability does not have a CVE code, THE Dashboard SHALL display "N/A" or similar indicator
6. WHEN displaying CVE information in tables and cards, THE Dashboard SHALL format it consistently

